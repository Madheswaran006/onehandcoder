<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings | OneHandCoder</title>
  <style>
    /* Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

    body {
      background: linear-gradient(145deg, #0d1117, #1a1f2b);
      color: #e6edf3;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(90deg, #3b82f6, #9333ea);
      padding: 1.5rem;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      color: white;
      letter-spacing: 1px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    nav {
      display: flex;
      justify-content: center;
      background: #161b22;
      padding: 1rem;
      gap: 2rem;
      border-bottom: 2px solid #3b82f6;
    }
    nav a { color: #e6edf3; text-decoration: none; font-weight: bold; font-size: 1.1rem; transition: color 0.3s; }
    nav a:hover { color: #3b82f6; }

    .section { max-width: 900px; margin: 2rem auto; padding: 2rem; display: flex; flex-direction: column; gap: 1.5rem; }

    .card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0,0,0,0.7); }
    .card h3 { font-size: 1.2rem; color: #facc15; }

    .info { font-size: 0.95rem; color: #d1d5db; }

    .btn {
      padding: 0.6rem 1.2rem; border: none; border-radius: 8px;
      background: #22c55e; color: white; font-weight: bold;
      cursor: pointer; transition: 0.3s;
    }
    .btn:hover { transform: scale(1.05); opacity: 0.9; }

    /* Toggle switch */
    .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc; border-radius: 34px; transition: 0.4s;
    }
    .slider:before {
      position: absolute; content: ""; height: 22px; width: 22px; left: 3px; bottom: 3px;
      background-color: white; border-radius: 50%; transition: 0.4s;
    }
    input:checked + .slider { background: #3b82f6; }
    input:checked + .slider:before { transform: translateX(22px); }

    /* Storage bar */
    .storage-bar {
      background: #161b22; border-radius: 10px; overflow: hidden;
      height: 20px; width: 60%; margin-top: 5px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    }
    .storage-used { height: 100%; background: #3b82f6; width: 0%; transition: width 1s ease-in-out; }
  </style>
</head>
<body>

  <header>⚙ Settings | OneHandCoder</header>

  <nav>
    <a href="index.html">Home</a>
    <a href="learn.html">Learn</a>
    <a href="practice.html">Practice</a>
    <a href="support.html">Support</a>
    <a href="profile.html">Profile</a>
    <a href="settings.html">⚙ Settings</a>
  </nav>

  <section class="section">
    <!-- Toggles -->
    <div class="card"><h3>Dark Mode</h3><label class="switch"><input type="checkbox" id="darkModeToggle"><span class="slider"></span></label></div>
    <div class="card"><h3>Voice Input</h3><label class="switch"><input type="checkbox" id="voiceToggle"><span class="slider"></span></label></div>
    <div class="card"><h3>Notifications</h3><label class="switch"><input type="checkbox" id="notifToggle"><span class="slider"></span></label></div>
    <div class="card"><h3>Auto-Save Code</h3><label class="switch"><input type="checkbox" id="autosaveToggle"><span class="slider"></span></label></div>

    <!-- Account Info -->
    <div class="card">
      <div>
        <h3>Account Info</h3>
        <div class="info">Username: <b id="username">Loading...</b></div>
        <div class="info">Email: <b id="email">Loading...</b></div>
        <div class="info">Subscription: <b id="subscription">Loading...</b></div>
      </div>
      <button class="btn" onclick="editAccount()">Edit</button>
    </div>

    <!-- Storage -->
    <div class="card">
      <div>
        <h3>Storage</h3>
        <div class="storage-bar"><div class="storage-used" id="storageUsed"></div></div>
        <div class="info" id="storageInfo">Used: 0 MB / 500 MB</div>
      </div>
      <button class="btn" onclick="clearStorage()">Clear</button>
    </div>

    <!-- Version -->
    <div class="card"><h3>App Version</h3><div class="info">1.0.0</div></div>

    <!-- Reset Progress -->
    <div class="card"><h3>Reset Progress</h3><button class="btn" onclick="resetProgress()">Reset</button></div>
  </section>

  <script>
   
    let usedStorage = 0;
    let maxStorage = 500;

    function updateStorageBar() {
      const percent = (usedStorage / maxStorage) * 100;
      document.getElementById("storageUsed").style.width = percent + "%";
      document.getElementById("storageInfo").innerText = `Used: ${usedStorage} MB / ${maxStorage} MB`;
    }

    // Load settings from backend
    async function loadSettings() {
      const res = await fetch("http://localhost:5000/api/settings", {
        headers: { "Authorization": "Bearer " + token }
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById("username").innerText = data.username;
        document.getElementById("email").innerText = data.email;
        document.getElementById("subscription").innerText = data.subscription;

        usedStorage = data.usedStorageMB;
        maxStorage = data.maxStorageMB;
        updateStorageBar();
      }
    }

    // Edit account info
    async function editAccount() {
      const newUsername = prompt("Enter new username:");
      const newEmail = prompt("Enter new email:");
      const newPassword = prompt("Enter new password (optional):");

      const res = await fetch("http://localhost:5000/api/settings/update", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ username: newUsername, email: newEmail, password: newPassword })
      });
      const data = await res.json();
      alert(data.message);
      loadSettings();
    }

    // Reset progress
    async function resetProgress() {
      if (confirm("Are you sure you want to reset your progress?")) {
        const res = await fetch("http://localhost:5000/api/settings/reset-progress", {
          method: "POST",
          headers: { "Authorization": "Bearer " + token }
        });
        const data = await res.json();
        alert(data.message);
      }
    }

    // Clear storage (client-side only)
    function clearStorage() {
      if (confirm("Clear all saved storage?")) {
        usedStorage = 0;
        updateStorageBar();
        alert("Storage cleared locally (server saved programs remain).");
      }
    }

    // Feature toggles
    document.getElementById("darkModeToggle").addEventListener("change", e => {
      document.body.style.background = e.target.checked ? "#f0f0f0" : "linear-gradient(145deg, #0d1117, #1a1f2b)";
      document.body.style.color = e.target.checked ? "#111" : "#e6edf3";
    });
    document.getElementById("voiceToggle").addEventListener("change", e => alert("Voice input " + (e.target.checked ? "enabled" : "disabled")));
    document.getElementById("notifToggle").addEventListener("change", e => alert("Notifications " + (e.target.checked ? "enabled" : "disabled")));
    document.getElementById("autosaveToggle").addEventListener("change", e => alert("Auto-save " + (e.target.checked ? "enabled" : "disabled")));

    loadSettings();
  </script>
</body>
</html>
